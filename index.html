<!DOCTYPE html>

<html>

<head>

	<title>Boston Transportation Map</title>

	<meta name="viewport"
	content="width=device-width, initial-scale=1.0">

	<meta charset="utf-8">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  	<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
   <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />

	<script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />

	<style>

		#title {
			font-size: 2em;
			font-family: 'Ubuntu', serif;
			font-weight: bold;
			color: #696969;
			letter-spacing: .08em;
			position: fixed;
			margin-top: 0;
			top: 20px;
			left: 20px;
			padding: 15px 15px;
			background-color: rgba(255, 255, 255, 0.8);
			border: 1px hidden;
			border-radius: 3px;
			z-index: 800;
		}

		#description {
			font-size: .7em;
			font-family: 'Lora', sans-serif;
			font-weight: normal;
			color: #696969;
			position: fixed;
			top: 30%;
			left: 20px;
			width: 30%;
			padding: 10px 10px;
			background-color: rgba(255, 255, 255, 0.8);
			border: 1px hidden;
			border-radius: 3px;
			z-index: 800;
		}
		
		#author {
			font-size: .5em;
			font-family: "Lora", sans-serif;
			font-weight: normal;
			position: fixed;
			bottom: 20px;
			left: 20px;
			width: 55px;
			color: #696969;
			background-color: rgba(255, 255, 255, 0.8);
            border: 1px hidden;
            border-radius: 3px;
            z-index: 800;
		}
	
	</style>

</head>

	<body>

		<div id='map' style ='width:100%; height:100%; position:absolute;'></div>

		<h1 id= 'title'>
			Boston Transportation Map
		</h1>

		<h2 id= 'description'>
			<p>"Boston" does not necessarily refer to the area within city limits.</p>
      		<p>People often use the include the suburbs since it feels like a single urban region. It is not helped that the neighborhoods within Boston are significantly different from one another and often separated by major freeways. With an infrastructure geared so heavily in favor of cars, the transition between city and suburb barely unnoticeable.</p>
      		<p>The gray-scale choropleth map layer shows population density across the metro area. Seeing as population density is not higher in Boston city proper, transportation from and across suburbs is critical.
      		<p>The highways, in red, are designed to transport drivers into the city from the periphery and connect the periphery in a series of concentric circles emanating from the city. In this manner, the highways create zones and loops that determine proximity and accessibility to the city.</p>
      		<p>The Boston Metro area is unfortunately known for its heavy traffic and poor public transit infrastructure. The line lines and dots show, respectively, bus lines and stops and connect towns and neighbourhoods within the highway zones.</p>
		</h2>
		
		<h3 id='author'>
			Claire Craig
		</h3>

		<script src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
		<script>

			mapboxgl.accessToken = 'pk.eyJ1IjoiY2xhaXJlLWNnIiwiYSI6ImNrbnA3bjZxdTAwOHQyb3FwdXhhbDM5d3cifQ.cX3_pLwyHaV0y3N6_X6yaw';

			var map = new mapboxgl.Map({
				container: 'map',
				style: 'mapbox://styles/claire-cg/cknrt5unw11gm17qurgkky7z8',
				center: [-71.15229363080779, 42.35],
				zoom: 9 
			});

			//first I tried using the leaflet method from the first map to include popups
			$.getJSON("data/busRoutes.geojson",function(data){
				L.geoJson(data, {
					onEachFeature: function(feature,layer){
						layer.bindPopup(feature.properties.MBTA_ROUTE),
					{color: "#8bb9d0", opacity: 0.5, weight: 2};
					}
				}).addTo(map);
				});
			
			$.get('data/data.csv', function(csvString) {

		    var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;

		    for (var i in data) {
		      var row = data[i];

		      var popupContent="<p>"+row.city+"<p>"+"Total workers:"+row.tot_workers_over16+"<p>"+"Workers who drove alone in a car, truck, or van:"+row.alone_car_truck_van+"<p>"+"Workers who carpooled:"+row.carpool_car_truck_van+"<p>"+"Workers who used public transit:"+row.pub_trans+"<p>";

		      var marker = L.marker([row.latitude, row.longitude], {
		        opacity: 0.8,
		        icon: L.icon({
		        	iconUrl: 'image/car.png',
		        	iconSize: [40,40]})
		      }).bindPopup(popupContent);
		      
		      marker.addTo(map);
		    }
		  	});
			
			//then I tried using the methods recommended by mapbox tutorials of calling in an external geojson file hosted locally
			function load() {
			$.ajax({
			    headers: {
				      'Accept': 'application/vnd.github.v3.raw'
				},
				 xhrFields: {
			      	withCredentials: false
			    },
			    dataType: 'json',
			    url: url,
			    success: function(geojson) {
			        L.mapbox.featureLayer(geojson).addTo(map);
			    }
			  });
			}
			$(load);

			var myLayer = L.mapbox.featureLayer().setGeoJSON(geojson).addTo(map);

			myLayer.on('layeradd', function(e) {
			  var marker = e.layer,
			  	feature = marker.feature;
			  marker.setIcon(L.icon('feature.properties.icon'));
			  var content = "<p>"+feature.properties.city+"<p>"+"Total workers:"+feature.properties.tot_workers_over16+"<p>"+"Workers who drove alone in a car, truck, or van:"+feature.properties.alone_car_truck_van+"<p>"+"Workers who carpooled:"+feature.properties.carpool_car_truck_van+"<p>"+"Workers who used public transit:"+feature.properties.pub_trans+"<p>";
			  marker.bindPopup(content);
			});
			myLayer.setGeoJSON(geojson);
			mapPopupsJS.scrollWheelZoom.disable();

			//I tried another method from the mapbox tutorials
			map.on('click', function(e) {
		      var features = map.queryRenderedFeatures(e.point, {
		        layers: ['busroutes']
		      });
		      if (!features.length) {return;
		     }
		      var feature = features[0];
		      var popup = new mapboxgl.Popup({ offset: [0, -15] }).setLngLat(feature.properties.MBTA_ROUTE)
		        .setHTML('<p>' + feature.properties.MBTA_ROUTE + '<p>')
		        .addTo(map);
		    });

		    //I also tried putting the geojson file into the code directly
		    var geojson [
			{"type": "FeatureCollection",
			"name": "data",
			"features": [
			{ "type": "Feature", "properties": { "city": "Somerville", "tot_workers_over16": "30,025", "alone_car_truck_van": "16,741", "carpool_car_truck_van": "1,882", "pub_trans": "5,068", "icon": "image/car.png", "longitude": -71.0995, "latitude": 42.3876 }, "geometry": null },
			{ "type": "Feature", "properties": { "city": "Boston", "tot_workers_over16": "722,210", "alone_car_truck_van": "294,131", "carpool_car_truck_van": "41,854", "pub_trans": "276,422", "icon": "image/car.png", "longitude": -71.0589, "latitude": 42.3601 }, "geometry": null },
			{ "type": "Feature", "properties": { "city": "Cambridge", "tot_workers_over16": "151,600", "alone_car_truck_van": "62,239", "carpool_car_truck_van": "9,588", "pub_trans": "45,826", "icon": "image/car.png", "longitude": -71.1097, "latitude": 42.3736 }, "geometry": null },
			{ "type": "Feature", "properties": { "city": "Lynn", "tot_workers_over16": "24,235", "alone_car_truck_van": "24,235", "carpool_car_truck_van": "2,629", "pub_trans": "361", "icon": "image/car.png", "longitude": -70.9495, "latitude": 42.4668 }, "geometry": null },
			{ "type": "Feature", "properties": { "city": "Newton", "tot_workers_over16": "53,342", "alone_car_truck_van": "36,278", "carpool_car_truck_van": "3,031", "pub_trans": "5,663", "icon": "image/car.png", "longitude": -71.2092, "latitude": 42.337 }, "geometry": null },
			{ "type": "Feature", "properties": { "city": "Quincy", "tot_workers_over16": "45,979", "alone_car_truck_van": "34,832", "carpool_car_truck_van": "2,705", "pub_trans": "4,162", "icon": "image/car.png", "longitude": -71.0023, "latitude": 42.2529 }, "geometry": null }
			]}];

			var myLayer = L.mapbox.featureLayer().setGeoJSON(geojson).addTo(mapGeo);
			mapGeo.scrollWheelZoom.disable();

		</script>

				</body>

</html>